{% extends 'core/base.html' %}

{% block title %}Accueil - E-MPJ{% endblock %}

{% block content %}
<div class="bg-white dark:bg-gray-900">
    <!-- Hero Section -->
    <div class="relative h-[350px] md:h-[400px] overflow-hidden" data-animation="fade" data-delay="100">
        <!-- Bordures dÃ©coratives -->
        <div class="absolute inset-3 border border-white/10 rounded-xl z-10" data-animation="scale" data-delay="300"></div>
        <div class="absolute inset-5 border border-white/5 rounded-xl z-10" data-animation="scale" data-delay="400"></div>
        
        <!-- Coins dÃ©coratifs avec animation amÃ©liorÃ©e -->
        <div class="absolute top-6 left-6 w-8 h-8 border-t-2 border-l-2 border-primary-500 z-20 animate-border-flow" data-animation="slide" data-delay="500"></div>
        <div class="absolute top-6 right-6 w-8 h-8 border-t-2 border-r-2 border-primary-500 z-20 animate-border-flow" data-animation="slide" data-delay="600"></div>
        <div class="absolute bottom-6 left-6 w-8 h-8 border-b-2 border-l-2 border-primary-500 z-20 animate-border-flow" data-animation="slide" data-delay="700"></div>
        <div class="absolute bottom-6 right-6 w-8 h-8 border-b-2 border-r-2 border-primary-500 z-20 animate-border-flow" data-animation="slide" data-delay="800"></div>

        <!-- Fond dynamique avec effet parallaxe -->
        <div class="absolute inset-0 overflow-hidden" data-animation="scale" data-delay="200">
            <div class="hero-carousel relative w-full h-full">
                <!-- Images du carrousel -->
                <div class="carousel-container absolute inset-0 transition-transform duration-1000">
                    {% for product in featured_products %}
                    <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000">
                        {% if product.image %}
                        <img src="{{ product.image.url }}"
                             alt="{{ product.name }}"
                             class="w-full h-full object-cover transform scale-105 transition-all duration-1000">
                        {% else %}
                        <div class="w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                            <span class="text-gray-400">Image non disponible</span>
                        </div>
                        {% endif %}
                        <div class="absolute inset-0 bg-gradient-to-r from-black/80 to-transparent"></div>
                        <div class="absolute bottom-10 left-10 text-white">
                            <h3 class="text-2xl font-bold mb-2">{{ product.name }}</h3>
                            <p class="text-lg mb-4">{{ product.category.name }}</p>
                            <a href="{{ product.get_absolute_url }}" class="inline-block bg-primary-500 text-white px-6 py-2 rounded-md hover:bg-primary-600 transition-colors">
                                Voir le produit
                            </a>
                        </div>
                    </div>
                    {% empty %}
                    <div class="carousel-slide absolute inset-0 opacity-0 transition-opacity duration-1000">
                        <div class="w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                            <span class="text-gray-400">Aucun produit mis en avant</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- ContrÃ´les du carrousel -->
                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-3 z-30">
                    {% for product in featured_products %}
                    <button class="carousel-dot w-3 h-3 rounded-full bg-white/50 hover:bg-white/80 transition-colors duration-300 hover:scale-110"></button>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Contenu principal -->
        <div class="absolute inset-0 flex items-center z-20">
            <div class="container mx-auto px-4">
                <div class="max-w-2xl relative">
                    <!-- Ã‰lÃ©ment dÃ©coratif -->
                    <div class="absolute -left-4 top-0 w-1 h-16 bg-primary-500 transform -skew-y-45 animate-glow" data-animation="slide-up" data-delay="900"></div>
                    
                    <!-- Texte principal -->
                    <div class="ml-6">
                        <span class="inline-block px-4 py-1.5 bg-primary-500/20 text-primary-400 rounded-full text-sm font-medium mb-3 backdrop-blur-sm border border-primary-500/20 shadow-lg shadow-primary-500/10" data-animation="slide-up" data-delay="1000">
                            <span class="animate-pulse mr-2">ðŸš€</span> DÃ©couvrez notre nouvelle collection
                        </span>
                        <h1 class="text-3xl md:text-5xl font-bold mb-3 text-white leading-tight" data-animation="slide-up" data-delay="1100">
                            {{ hero.title }}
                            <span class="text-primary-400 animate-pulse">.</span>
                        </h1>
                        <p class="text-lg md:text-xl mb-6 text-gray-300 max-w-xl leading-relaxed" data-animation="slide-up" data-delay="1200">
                            {{ hero.subtitle }}
                        </p>
                        
                        <!-- Boutons d'action avec bordures lumineuses -->
                        <div class="flex flex-wrap gap-3" data-animation="slide-up" data-delay="1300">
                            <a href="{% url 'products:product_list' %}" 
                               class="group relative inline-flex items-center bg-primary-500 text-white px-6 py-2.5 rounded-full text-base font-medium hover:bg-primary-600 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg hover:shadow-primary-500/25 border border-primary-500/50">
                                <span class="relative z-10">Explorer la collection</span>
                                <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform relative z-10" 
                                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                                </svg>
                                <div class="absolute inset-0 rounded-full bg-gradient-to-r from-primary-600 to-primary-400 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                            </a>
                            <a href="#categories" 
                               class="group relative inline-flex items-center bg-white/5 text-white px-6 py-2.5 rounded-full text-base font-medium hover:bg-white/10 transition-all duration-300 backdrop-blur-sm hover:shadow-lg border border-white/10">
                                <span class="relative z-10">En savoir plus</span>
                                <div class="absolute inset-0 rounded-full bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                            </a>
                        </div>

                        <!-- Statistiques avec bordures et effets -->
                        <div class="flex gap-6 mt-8" data-animation="slide-up" data-delay="1400">
                            {% for stat in stats %}
                            <div class="text-white/80 relative group" data-animation="fade" data-delay="{{ forloop.counter|add:1400 }}">
                                <div class="absolute inset-0 bg-white/5 rounded-lg -z-10 transform group-hover:scale-105 transition-transform duration-300"></div>
                                <div class="px-4 py-2 border border-white/10 rounded-lg backdrop-blur-sm hover:border-primary-500/30 transition-colors duration-300">
                                    <span class="block text-xl font-bold text-primary-400 group-hover:scale-110 transition-transform duration-300">{{ stat.value }}</span>
                                    <span class="text-xs">{{ stat.label }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ã‰lÃ©ments dÃ©coratifs flottants amÃ©liorÃ©s -->
        <div class="absolute top-16 right-16 w-24 h-24 bg-primary-500/20 rounded-full blur-2xl animate-float" data-animation="fade" data-delay="1600"></div>
        <div class="absolute bottom-8 right-32 w-20 h-20 bg-primary-400/20 rounded-full blur-xl animate-float-delayed" data-animation="fade" data-delay="1700"></div>
        <div class="absolute top-32 right-48 w-12 h-12 bg-white/10 rounded-full blur-lg animate-float-slow" data-animation="fade" data-delay="1800"></div>
    </div>

    <!-- CatÃ©gories -->
    <div class="container mx-auto px-4 py-16" id="categories">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-8 text-center" data-animation="slide-up">
            DÃ©couvrez nos CatÃ©gories
            <span class="block text-sm font-normal text-gray-600 dark:text-gray-400 mt-2">SÃ©lection alÃ©atoire de nos meilleures catÃ©gories</span>
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="categories-grid">
            {% for category in categories %}
            <a href="{% url 'products:category_detail' category.slug %}" 
               class="group relative h-80 overflow-hidden rounded-lg shadow-lg transform transition-all duration-500 hover:scale-[1.02] category-card" 
               data-animation="slide-up" 
               data-delay="{{ forloop.counter0|add:1|add:1|add:1|add:1|add:1 }}00"
               data-category-id="{{ category.id }}"
               data-category-slug="{{ category.slug }}">
                {% if category.image %}
                <img src="{{ category.image.url }}" 
                     alt="{{ category.name }}" 
                     class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                {% else %}
                <div class="w-full h-full bg-gradient-to-br from-primary-500/20 to-primary-600/20 dark:from-primary-800/20 dark:to-primary-900/20 flex items-center justify-center">
                    <div class="text-center p-6">
                        <svg class="w-16 h-16 mx-auto text-primary-500/50 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-gray-500 dark:text-gray-400">Image non disponible</span>
                    </div>
                </div>
                {% endif %}
                
                <!-- Overlay avec dÃ©gradÃ© amÃ©liorÃ© -->
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent opacity-60 group-hover:opacity-70 transition-opacity duration-500"></div>
                
                <!-- Contenu de la catÃ©gorie -->
                <div class="absolute bottom-0 left-0 right-0 p-6 transform translate-y-2 group-hover:translate-y-0 transition-transform duration-500">
                    <h3 class="text-2xl font-bold text-white mb-2 transform group-hover:scale-105 transition-transform duration-500">
                        {{ category.name }}
                    </h3>
                    {% if category.description %}
                    <p class="text-gray-200 mb-4 opacity-0 group-hover:opacity-100 transition-all duration-500 transform translate-y-4 group-hover:translate-y-0">
                        {{ category.description|truncatechars:100 }}
                    </p>
                    {% endif %}
                    <span class="inline-flex items-center bg-white text-gray-900 px-6 py-2 rounded-md text-sm font-medium 
                               hover:bg-primary-500 hover:text-white transition-all duration-300 
                               transform -translate-y-full group-hover:translate-y-0 opacity-0 group-hover:opacity-100">
                        Explorer
                        <svg class="w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform" 
                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                        </svg>
                    </span>
                </div>
            </a>
            {% empty %}
            <div class="col-span-full text-center py-12">
                <div class="max-w-md mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg">
                    <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M12 12h.01M12 12a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    <h3 class="text-xl text-gray-600 dark:text-gray-400">Aucune catÃ©gorie disponible pour le moment</h3>
                    <p class="text-gray-500 dark:text-gray-500 mt-2">Revenez plus tard pour dÃ©couvrir nos catÃ©gories</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- BanniÃ¨re promotionnelle -->
    <div class="bg-primary-500 dark:bg-primary-600" data-animation="fade">
        <div class="container mx-auto px-4 py-12">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="text-white text-center md:text-left mb-6 md:mb-0" data-animation="slide-up" data-delay="200">
                    <h2 class="text-2xl font-bold mb-2">{{ promo.title }}</h2>
                    <p class="text-lg">{{ promo.description }}</p>
                </div>
                <a href="{% url 'products:product_list' %}" 
                   class="inline-block bg-white text-primary-500 px-8 py-3 rounded-md text-lg font-medium hover:bg-gray-100 transition-colors"
                   data-animation="slide-up" data-delay="400">
                    En profiter
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialisation du carrousel
        const carousel = {
            container: document.querySelector('.carousel-container'),
            slides: document.querySelectorAll('.carousel-slide'),
            dots: document.querySelectorAll('.carousel-dot'),
            prevBtn: document.querySelector('.carousel-arrow.prev'),
            nextBtn: document.querySelector('.carousel-arrow.next'),
            currentSlide: 0,
            interval: null,
            duration: 5000,
            touchStartX: 0,
            touchEndX: 0,
            isAnimating: false,

            init() {
                this.showSlide(0);
                this.startAutoPlay();
                this.initControls();
                this.initTouchEvents();
                this.initKeyboardEvents();
                this.initZoomEffect();
            },

            showSlide(index) {
                if (this.isAnimating) return;
                this.isAnimating = true;

                // Masquer toutes les slides
                this.slides.forEach(slide => {
                    slide.style.opacity = '0';
                    slide.style.zIndex = '0';
                });

                // DÃ©sactiver tous les points
                this.dots.forEach(dot => {
                    dot.classList.remove('bg-white', 'scale-110');
                    dot.classList.add('bg-white/50');
                });

                // Afficher la slide sÃ©lectionnÃ©e avec animation
                setTimeout(() => {
                    this.slides[index].style.opacity = '1';
                    this.slides[index].style.zIndex = '1';

                    // Activer le point correspondant
                    this.dots[index].classList.remove('bg-white/50');
                    this.dots[index].classList.add('bg-white', 'scale-110');

                    // Ajouter l'effet ken burns
                    this.slides.forEach((slide, i) => {
                        const img = slide.querySelector('img');
                        if (i === index) {
                            img.style.transform = 'scale(1.1)';
                        } else {
                            img.style.transform = 'scale(1.05)';
                        }
                    });

                    this.currentSlide = index;
                    this.isAnimating = false;
                }, 300);
            },

            prevSlide() {
                const prev = (this.currentSlide - 1 + this.slides.length) % this.slides.length;
                this.showSlide(prev);
            },

            nextSlide() {
                const next = (this.currentSlide + 1) % this.slides.length;
                this.showSlide(next);
            },

            initControls() {
                // Points de navigation
                this.dots.forEach((dot, index) => {
                    dot.addEventListener('click', () => {
                        if (!this.isAnimating) {
                            this.showSlide(index);
                            this.restartAutoPlay();
                        }
                    });
                });

                // FlÃ¨ches de navigation
                this.prevBtn.addEventListener('click', () => {
                    if (!this.isAnimating) {
                        this.prevSlide();
                        this.restartAutoPlay();
                    }
                });

                this.nextBtn.addEventListener('click', () => {
                    if (!this.isAnimating) {
                        this.nextSlide();
                        this.restartAutoPlay();
                    }
                });

                // Pause au survol
                this.container.addEventListener('mouseenter', () => this.stopAutoPlay());
                this.container.addEventListener('mouseleave', () => this.startAutoPlay());
            },

            initTouchEvents() {
                this.container.addEventListener('touchstart', (e) => {
                    this.touchStartX = e.touches[0].clientX;
                    this.stopAutoPlay();
                });

                this.container.addEventListener('touchmove', (e) => {
                    if (this.isAnimating) return;
                    this.touchEndX = e.touches[0].clientX;
                    const diff = this.touchStartX - this.touchEndX;
                    const threshold = 50;

                    if (Math.abs(diff) > threshold) {
                        if (diff > 0) {
                            this.nextSlide();
                        } else {
                            this.prevSlide();
                        }
                        this.touchStartX = 0;
                        this.touchEndX = 0;
                    }
                });

                this.container.addEventListener('touchend', () => {
                    this.startAutoPlay();
                });
            },

            initKeyboardEvents() {
                document.addEventListener('keydown', (e) => {
                    if (this.isAnimating) return;
                    if (e.key === 'ArrowLeft') {
                        this.prevSlide();
                        this.restartAutoPlay();
                    } else if (e.key === 'ArrowRight') {
                        this.nextSlide();
                        this.restartAutoPlay();
                    }
                });
            },

            initZoomEffect() {
                this.slides.forEach(slide => {
                    const img = slide.querySelector('img');
                    
                    slide.addEventListener('mouseenter', () => {
                        if (slide.style.opacity === '1') {
                            img.style.transform = 'scale(1.15)';
                        }
                    });

                    slide.addEventListener('mousemove', (e) => {
                        if (slide.style.opacity === '1') {
                            const rect = slide.getBoundingClientRect();
                            const x = (e.clientX - rect.left) / rect.width;
                            const y = (e.clientY - rect.top) / rect.height;
                            
                            img.style.transformOrigin = `${x * 100}% ${y * 100}%`;
                        }
                    });

                    slide.addEventListener('mouseleave', () => {
                        if (slide.style.opacity === '1') {
                            img.style.transform = 'scale(1.1)';
                        }
                    });
                });
            },

            startAutoPlay() {
                if (this.interval) return;
                this.interval = setInterval(() => this.nextSlide(), this.duration);
            },

            stopAutoPlay() {
                if (this.interval) {
                    clearInterval(this.interval);
                    this.interval = null;
                }
            },

            restartAutoPlay() {
                this.stopAutoPlay();
                this.startAutoPlay();
            }
        };

        // Initialiser le carrousel
        carousel.init();

        // Animation des catÃ©gories
        const categories = document.querySelectorAll('.grid > div');
        categories.forEach((category, index) => {
            setTimeout(() => {
                category.classList.add('animate-fade-in');
            }, 100 * index);
        });

        // Animation du dÃ©filement doux
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Gestion des catÃ©gories
        function handleCategoryClick(categoryCard) {
            const categoryId = categoryCard.dataset.categoryId;
            const categorySlug = categoryCard.dataset.categorySlug;
            
            // GÃ©rer l'indicateur de sÃ©lection
            const indicator = categoryCard.querySelector('.category-indicator');
            const allIndicators = document.querySelectorAll('.category-indicator');
            
            // RÃ©initialiser tous les indicateurs
            allIndicators.forEach(ind => ind.style.transform = 'scale(0)');
            
            // Afficher l'indicateur de la catÃ©gorie sÃ©lectionnÃ©e
            indicator.style.transform = 'scale(1)';
            
            // Trouver le lien correspondant dans la navbar
            const navbarCategoryLink = document.querySelector(`.navbar-category[data-category-slug="${categorySlug}"]`);
            if (navbarCategoryLink) {
                // Simuler un hover sur le menu des catÃ©gories
                const categoriesDropdown = document.querySelector('.dropdown-button[aria-expanded="false"]');
                if (categoriesDropdown) {
                    categoriesDropdown.setAttribute('aria-expanded', 'true');
                    const dropdownMenu = categoriesDropdown.nextElementSibling;
                    dropdownMenu.classList.remove('hidden');
                    
                    // Mettre en surbrillance la catÃ©gorie dans le menu
                    const allNavLinks = dropdownMenu.querySelectorAll('a');
                    allNavLinks.forEach(link => link.classList.remove('bg-gray-100', 'dark:bg-gray-600'));
                    navbarCategoryLink.classList.add('bg-gray-100', 'dark:bg-gray-600');
                    
                    // Faire dÃ©filer jusqu'Ã  l'Ã©lÃ©ment
                    navbarCategoryLink.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            // Rediriger vers la page des produits de la catÃ©gorie aprÃ¨s un court dÃ©lai
            setTimeout(() => {
                window.location.href = `/products/?category=${categorySlug}`;
            }, 500);
        }

        // Rendre la fonction disponible globalement
        window.handleCategoryClick = handleCategoryClick;
    });
</script>
{% endblock %}
